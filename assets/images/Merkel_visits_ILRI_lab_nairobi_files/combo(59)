YUI.add("photo-license-view",function(e,t){var i=require("hermes-core/flog")(t),n={debug:!1,css:{license:".photo-license-info .ui-dropdown"},stateCSS:{working:"working",apiError:"api-error"}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",this.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e=this.get("photo"),t=e.getValue("isOwner"),i=e?e.getValue("license"):"none";return this.setContainerWithTemplate("photo-license",{license:i,licenseIsEditable:t&&7!==i&&8!==i,licenseIsCreativeCommons:0!==i&&7!==i&&8!==i&&10!==i,licenseisGovt:8===i,licenseisNoLic:7===i,licenseisCopy:0===i,licenseIsCC0:9===i,licenseIsPDW:10===i}),this},activate:function(){var t=this.get("container"),i=this.get("photo"),s=this;return this.licenseDd=new e.Views.Dropdown({appContext:this.appContext,container:t.one(n.css.license),selected:i.getValue("license"),disabled:!i.getValue("isOwner"),labelFunction:function(e){return s.mapLicense(i.getValue("license"))}}),this.licenseDd.on("open",function(t){s.fire("viewEvent","make in view",s.licenseDd.get("container")),e.rapidTracker.beacon(s.name,"licenseSettingMenuClick")}),this.licenseDd.on("close",function(e){s.fire("viewEvent","close in view")}),this.licenseDd.on("selected",function(e){s.setLicense(e.clicked.value)}),this.on("destroy",function(){s.licenseDd&&s.licenseDd.destroy()}),this},setLicense:function(e){var t=this.get("photo"),s=t.getValue("license"),o=this.mapLicenseUrl(s),c=this.get("container").one(".photo-license-info"),a=this.get("container").one(".photo-license-info a"),r=0!==parseInt(e,10)&&7!==parseInt(e,10)&&8!==parseInt(e,10),l=this.mapLicenseUrl(e),p=this;c&&(c.removeClass(n.stateCSS.apiError),c.addClass(n.stateCSS.working)),t.setValue("license",e),r?(a.one("i").removeClass("ui-icon-tiny-copyright"),a.one("i").removeClass("ui-icon-tiny-"+s+"cc"),a.one("i").addClass("ui-icon-tiny-"+e+"cc"),this.get("container").one(".photo-license-url-iconOnly").set("rel","license cc:license")):(a.one("i").removeClass("ui-icon-tiny-"+s+"cc"),a.one("i").addClass("ui-icon-tiny-copyright"),this.get("container").one(".photo-license-url-iconOnly").set("rel","license")),a.setAttribute("href",l),t.remoteUpdate().then(function(){c&&c.removeClass(n.stateCSS.working)},function(e){t.setValue("license",s),p.licenseDd.select(s),a.setAttribute("href",o),c&&(c.removeClass(n.stateCSS.working),c.addClass(n.stateCSS.apiError)),p.onError(p.intlMessage({intlName:"photo-page-scrappy.LICENSE_ERROR"})),i.error({err:e})}.bind(this))},mapLicenseUrl:function(e){return["https://help.flickr.com/en_us/change-your-photo's-license-in-flickr-B1SxTmjkX","https://creativecommons.org/licenses/by-nc-sa/2.0/","https://creativecommons.org/licenses/by-nc/2.0/","https://creativecommons.org/licenses/by-nc-nd/2.0/","https://creativecommons.org/licenses/by/2.0/","https://creativecommons.org/licenses/by-sa/2.0/","https://creativecommons.org/licenses/by-nd/2.0/","/commons/usage/","http://www.usa.gov/copyright.shtml","https://creativecommons.org/publicdomain/zero/1.0/","https://creativecommons.org/publicdomain/mark/1.0/"][e]},mapLicense:function(e){return[this.intlMessage({intlName:"photo-page-scrappy.ALL_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.SOME_RIGHTS_RESERVED"}),this.intlMessage({intlName:"photo-page-scrappy.NO_RESTRICTIONS"}),this.intlMessage({intlName:"photo-page-scrappy.USA_GOV_WORK"}),this.intlMessage({intlName:"photo-page-scrappy.PUBLIC_DOMAIN"}),this.intlMessage({intlName:"photo-page-scrappy.PUBLIC_DOMAIN"})][e]}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-license"],langBundles:["common","photo-page-scrappy","settings"]});YUI.add("hermes-lang-settings",function(e,i){e.Intl.add("hermes/settings","en-US",{SAFE:["Safe"],MODERATE:["Moderate"],RESTRICTED:["Restricted"],PUBLIC:["Public"],PRIVATE:["Private"],ANYONE:["Anyone"],FRIENDS:["Friends"],FAMILY:["Family"],FRIENDS_AND_FAMILY:["Friends & Family"],ONLY_YOU:["Only you"],PEOPLE_YOU_FOLLOW:["People you follow"],ANY_FLICKR_MEMBER:["Any Flickr member"],SOME_RIGHTS_RESERVED:["Some rights reserved"],ALL_RIGHTS_RESERVED:["All rights reserved"],ATTRIBUTION:["Attribution"],ATTRIBUTION_SHAREALIKE:["Attribution-ShareAlike"],ATTRIBUTION_NODERIVS:["Attribution-NoDerivs"],ATTRIBUTION_NONCOMMERCIAL:["Attribution-NonCommercial"],ATTRIBUTION_NONCOMMERCIAL_SHAREALIKE:["Attribution-NonCommercial-ShareAlike"],ATTRIBUTION_NONCOMMERCIAL_NODERIVS:["Attribution-NonCommercial-NoDerivs"],NO_COPYRIGHT_RESTRICTIONS:["No known copyright restrictions"],US_GOV_WORK:["United States government work"],PUBLIC_DOMAIN_DEDICATION:["Public Domain Dedication (CC0)"],PUBLIC_DOMAIN_WORK:["Public Domain Work"],PRIVATE_PENDING_VIDEO:["Private while being processed"],PRIVATE_FAILED_VIDEO:["Private because we couldn't process this video"]})},"@VERSION@",{requires:["intl"]});YUI.add("hermes-template-comment",function(n,e){var a=n.Template.Handlebars.revive({1:function(n,e,a,l,t){var i;return'\t\t\t<img src="'+n.escapeExpression(n.lambda(null!=(i=null!=(i=null!=e?e.author:e)?i.buddyicon:i)?i.default:i,e))+'" width="25" height="25">\n'},3:function(n,e,a,l,t){var i;return'\t\t\t<img src="'+n.escapeExpression(n.lambda(null!=(i=null!=e?e.author:e)?i.buddyicon:i,e))+'" width="25" height="25">\n'},5:function(n,e,a,l,t){var i,r,o=null!=e?e:{};return(null!=(i=a.if.call(o,null!=e?e.commentBelongsToViewer:e,{name:"if",hash:{},fn:n.program(6,t,0),inverse:n.program(12,t,0),data:t}))?i:"")+(null!=(i=a.if.call(o,null!=e?e.canCommentBeDeleted:e,{name:"if",hash:{},fn:n.program(18,t,0),inverse:n.noop,data:t}))?i:"")+'\t\t\t\t<a href="'+n.escapeExpression("function"==typeof(r=null!=(r=a.permalink||(null!=e?e.permalink:e))?r:a.helperMissing)?r.call(o,{name:"permalink",hash:{},data:t}):r)+'" class="comment-permalink ui-icon-comment-permalink" data-track="commentPermalinkClick" data-action="follow"></a>\n'},6:function(n,e,a,l,t){var i;return null!=(i=a.if.call(null!=e?e:{},null!=e?e.noIcons:e,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.program(9,t,0),data:t}))?i:""},7:function(n,e,a,l,t){return""},9:function(n,e,a,l,t){var i;return null!=(i=a.if.call(null!=e?e:{},null!=e?e.enabledEditableComments:e,{name:"if",hash:{},fn:n.program(10,t,0),inverse:n.noop,data:t}))?i:""},10:function(n,e,a,l,t){var i;return'\t\t\t\t\t\t\t<a href="#" class="comment-edit ui-icon-comment-edit" data-id="'+n.escapeExpression("function"==typeof(i=null!=(i=a.id||(null!=e?e.id:e))?i:a.helperMissing)?i.call(null!=e?e:{},{name:"id",hash:{},data:t}):i)+'" data-action="edit" title="Edit"></a>\n'},12:function(n,e,a,l,t){var i;return null!=(i=a.if.call(null!=e?e:{},null!=e?e.canComment:e,{name:"if",hash:{},fn:n.program(13,t,0),inverse:n.noop,data:t}))?i:""},13:function(n,e,a,l,t){var i,r,o,s=null!=e?e:{},c='\t\t\t\t\t\t<a href="#" class="comment-reply '+(null!=(i=a.if.call(s,null!=e?e.noIcons:e,{name:"if",hash:{},fn:n.program(7,t,0),inverse:n.program(14,t,0),data:t}))?i:"")+'" data-pathalias="'+n.escapeExpression(n.lambda(null!=(i=null!=e?e.author:e)?i.pathAlias:i,e))+'" data-action="reply" title="Reply">';return r=null!=(r=a.noIcons||(null!=e?e.noIcons:e))?r:a.helperMissing,o={name:"noIcons",hash:{},fn:n.program(16,t,0),inverse:n.noop,data:t},i="function"==typeof r?r.call(s,o):r,a.noIcons||(i=a.blockHelperMissing.call(e,i,o)),null!=i&&(c+=i),c+"</a>\n"},14:function(n,e,a,l,t){return"ui-icon-comment-reply"},16:function(n,e,a,l,t){return"Reply"},18:function(n,e,a,l,t){var i;return'\t\t\t\t\t<a href="#" class="comment-delete ui-icon-comment-delete" data-id="'+n.escapeExpression("function"==typeof(i=null!=(i=a.id||(null!=e?e.id:e))?i:a.helperMissing)?i.call(null!=e?e:{},{name:"id",hash:{},data:t}):i)+'" data-action="delete" title="Delete"></a>\n'},20:function(n,e,a,l,t){return n.escapeExpression((a.intlMessage||e&&e.intlMessage||a.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{time:null!=e?e.time:e,intlName:null!=e?e.intlName:e},data:t}))},22:function(n,e,a,l,t){return'        <div class="comment-content">'+n.escapeExpression((a.renderSafeInlineComment||e&&e.renderSafeInlineComment||a.helperMissing).call(null!=e?e:{},null!=e?e.contentSecure:e,null!=e?e.ellipsis:e,{name:"renderSafeInlineComment",hash:{},data:t}))+"</div>\n"},24:function(n,e,a,l,t){return'        <div class="comment-content">'+n.escapeExpression((a.renderTrustedMarkupWithLineBreaks||e&&e.renderTrustedMarkupWithLineBreaks||a.helperMissing).call(null!=e?e:{},null!=e?e.contentSecure:e,{name:"renderTrustedMarkupWithLineBreaks",hash:{},data:t}))+"</div>\n"},compiler:[7,">= 4.0.0"],main:function(n,e,a,l,t){var i,r=null!=e?e:{},o=a.helperMissing,s=n.escapeExpression,c=n.lambda;return'<li class="comment" id="'+s((a.commentPermalinkId||e&&e.commentPermalinkId||o).call(r,null!=e?e.id:e,{name:"commentPermalinkId",hash:{},data:t}))+'">\n\t<div class="comment-icon circle-icon">\n\t\t<a data-person-nsid="'+s(c(null!=(i=null!=e?e.author:e)?i.nsid:i,e))+'" href="/photos/'+s(c(null!=(i=null!=e?e.author:e)?i.pathAlias:i,e))+'/" data-track="commentBuddyIconClick" data-action="follow">\n'+(null!=(i=a.if.call(r,null!=(i=null!=(i=null!=e?e.author:e)?i.buddyicon:i)?i.default:i,{name:"if",hash:{},fn:n.program(1,t,0),inverse:n.program(3,t,0),data:t}))?i:"")+'\t\t</a>\n\t</div>\n\t<p class="comment-author">\n\t\t<a href="/photos/'+s(c(null!=(i=null!=e?e.author:e)?i.pathAlias:i,e))+'/" data-track="commentUserNameClick" data-action="follow">\n\t\t\t'+s((a.truncate||e&&e.truncate||o).call(r,null!=(i=null!=e?e.author:e)?i.displayname:i,20,{name:"truncate",hash:{},data:t}))+'\n\t\t</a>\n\t\t<span class="comment-actions">\n'+(null!=(i=a.if.call(r,null!=e?e.isSignedIn:e,{name:"if",hash:{},fn:n.program(5,t,0),inverse:n.noop,data:t}))?i:"")+'\t\t</span>\n\t</p>\n\t<div class="comment-date">'+(null!=(i=(a.friendlySinceDate||e&&e.friendlySinceDate||o).call(r,null!=e?e.timeago:e,!0,!1,{name:"friendlySinceDate",hash:{},fn:n.program(20,t,0),inverse:n.noop,data:t}))?i:"")+"</div>\n"+(null!=(i=a.if.call(r,null!=e?e.isTooltipComment:e,{name:"if",hash:{},fn:n.program(22,t,0),inverse:n.program(24,t,0),data:t}))?i:"")+"</li>\n"},useData:!0}),l={};n.Array.each([],function(e){var a=n.Template.get("hermes/"+e);a&&(l[e]=a)}),n.Template.register("hermes/comment",function(e,t){return t=t||{},t.partials=t.partials?n.merge(l,t.partials):l,a(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-comments",function(e,a){var n=e.Template.Handlebars.revive({1:function(e,a,n,t,r){var l;return"\t<ul class='comments'>\n"+(null!=(l=n.each.call(null!=a?a:{},null!=a?a.comments:a,{name:"each",hash:{},fn:e.program(2,r,0),inverse:e.noop,data:r}))?l:"")+"\t</ul>\n"},2:function(e,a,n,t,r){var l;return null!=(l=e.invokePartial(t.comment,a,{name:"comment",data:r,indent:"\t\t\t",helpers:n,partials:t,decorators:e.decorators}))?l:""},compiler:[7,">= 4.0.0"],main:function(e,a,n,t,r){var l;return null!=(l=n.if.call(null!=a?a:{},null!=a?a.comments:a,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r}))?l:""},usePartial:!0,useData:!0}),t={};e.Array.each(["comment"],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/comments",function(a,r){return r=r||{},r.partials=r.partials?e.merge(t,r.partials):t,n(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-comment"]});YUI.add("hermes-template-parseable-text-input",function(e,a){var l=e.Template.Handlebars.revive({1:function(e,a,l,n,t){var s;return'        <div data-textarea contenteditable="true" role="textbox" class="custom-text '+e.escapeExpression("function"==typeof(s=null!=(s=l.classList||(null!=a?a.classList:a))?s:l.helperMissing)?s.call(null!=a?a:{},{name:"classList",hash:{},data:t}):s)+'" tabindex="0"></div>\n'},3:function(e,a,l,n,t){var s,r=null!=a?a:{},i=l.helperMissing,u=e.escapeExpression;return'        <input class="'+u("function"==typeof(s=null!=(s=l.classList||(null!=a?a.classList:a))?s:i)?s.call(r,{name:"classList",hash:{},data:t}):s)+'" placeholder="'+u("function"==typeof(s=null!=(s=l.placeholder||(null!=a?a.placeholder:a))?s:i)?s.call(r,{name:"placeholder",hash:{},data:t}):s)+'" value="'+u("function"==typeof(s=null!=(s=l.content||(null!=a?a.content:a))?s:i)?s.call(r,{name:"content",hash:{},data:t}):s)+'">\n'},5:function(e,a,l,n,t){return"        "+e.escapeExpression((l.outlet||a&&a.outlet||l.helperMissing).call(null!=a?a:{},null!=a?a["emoji-picker-view"]:a,{name:"outlet",hash:{},data:t}))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,a,l,n,t){var s,r=null!=a?a:{};return'<div class="parseable-text-input">\n'+(null!=(s=l.if.call(r,null!=a?a.isTextArea:a,{name:"if",hash:{},fn:e.program(1,t,0),inverse:e.program(3,t,0),data:t}))?s:"")+(null!=(s=l.if.call(r,null!=a?a.showEmojis:a,{name:"if",hash:{},fn:e.program(5,t,0),inverse:e.noop,data:t}))?s:"")+"    \n</div>\n"},useData:!0}),n={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(n[a]=l)}),e.Template.register("hermes/parseable-text-input",function(a,t){return t=t||{},t.partials=t.partials?e.merge(n,t.partials):n,l(a,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-mentions-droparound",function(n,a){var e=n.Template.Handlebars.revive({1:function(n,a,e,t,l){var s,i=null!=a?a:{},r=e.helperMissing,o=n.escapeExpression;return'\t\t<li class="mention-item" data-mention-id="'+o("function"==typeof(s=null!=(s=e.nsid||(null!=a?a.nsid:a))?s:r)?s.call(i,{name:"nsid",hash:{},data:l}):s)+'">\n\t\t\t<span class="avatar person tiny no-menu" data-person-nsid="'+o("function"==typeof(s=null!=(s=e.nsid||(null!=a?a.nsid:a))?s:r)?s.call(i,{name:"nsid",hash:{},data:l}):s)+'" style="background-image: url('+o("function"==typeof(s=null!=(s=e.buddyicon||(null!=a?a.buddyicon:a))?s:r)?s.call(i,{name:"buddyicon",hash:{},data:l}):s)+');"></span>\n\t\t\t<span class="display-name">'+o("function"==typeof(s=null!=(s=e.text||(null!=a?a.text:a))?s:r)?s.call(i,{name:"text",hash:{},data:l}):s)+"</span>\n\t\t</li>\n"},compiler:[7,">= 4.0.0"],main:function(n,a,e,t,l){var s;return'<ul class="mentions-droparound">\n'+(null!=(s=e.each.call(null!=a?a:{},null!=a?a.mentions:a,{name:"each",hash:{},fn:n.program(1,l,0),inverse:n.noop,data:l}))?s:"")+"</ul>"},useData:!0}),t={};n.Array.each([],function(a){var e=n.Template.get("hermes/"+a);e&&(t[a]=e)}),n.Template.register("hermes/mentions-droparound",function(a,l){return l=l||{},l.partials=l.partials?n.merge(t,l.partials):t,e(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-emoji-picker",function(e,i){var n=e.Template.Handlebars.revive({1:function(e,i,n,a,r){return'\t\t<div class="picker-icon-wrapper mention-icon-wrapper">\n\t\t\t<svg class="icon icon-at"><use xlink:href="#icon-at"></use></svg>\n\t\t</div>\n'},compiler:[7,">= 4.0.0"],main:function(e,i,n,a,r){var s;return'<div class="new-comment-features">\n'+(null!=(s=(n.isFlipped||i&&i.isFlipped||n.helperMissing).call(null!=i?i:{},"enable-custom-text-parser",{name:"isFlipped",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r}))?s:"")+'\t<div class="picker-icon-wrapper flimoji-icon-wrapper">\n\t\t<svg class="icon icon-emoji flimoji flimoji-icon"><use xlink:href="#icon-emoji"></use></svg>\n\t</div>\n</div>\n<div class="emoji-area"></div>\n'},useData:!0}),a={};e.Array.each([],function(i){var n=e.Template.get("hermes/"+i);n&&(a[i]=n)}),e.Template.register("hermes/emoji-picker",function(i,r){return r=r||{},r.partials=r.partials?e.merge(a,r.partials):a,n(i,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("emoji-picker-view",function(e,i){require("hermes-core/flog")(i);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.dismissAreaClass="flimojis-dismiss-area",this.textArea=e.textArea||".new-comment-text",this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("emoji-picker",this.params),this},activate:function(){var i=require("@flickr/flimojis"),t=this.get("container");return this.emojiArea=t.one(".emoji-area").getDOMNode(),this.cursorPos=null,this.emojiPicker=new i.EmojiDropdown({enableSearchMenu:!0,inputElements:[this.textArea],headers:this.intlMessage({intlName:"comments.SELECT_EMOJI"}),unicode12:!1,iconsPath:e.config.flickr.urls.assetRoot+"/images/joypixels",language:this.appContext.lang,destinationArea:this.emojiArea,searchMenu:!0,searchButton:".flimoji-icon-wrapper",searchPlaceholder:this.intlMessage({intlName:"search.SEARCH"})}),this.button=t.one(".flimoji-icon-wrapper"),this.registerEventHandler(this.button.on("click",this.addPicker.bind(this))),this.emojiArea.addEventListener("emojiSelected",this.onEmojiSelected.bind(this)),this.appContext.flipper.isFlipped("enable-custom-text-parser")&&(this.textSpan=null,this.emojiPicked=!1),this},appendDimissArea:function(){e.one("body").append('<div class="'+this.dismissAreaClass+'"></div>'),this.registerEventHandler(e.one("body").one("."+this.dismissAreaClass).on("click",this.removePicker.bind(this)))},onEmojiSelected:function(e){this.appContext.flipper.isFlipped("enable-custom-text-parser")?(this.emojiPicked=!0,this.fire("emojiSelected",{emoji:e.detail.emoji,span:this.textSpan})):this.fire("emojiSelected",{emoji:e.detail.emoji,textarea:this.textArea,cursorPos:this.cursorPos}),this.removePicker()},addPicker:function(){this.emojiPicker.render(),this.appendDimissArea(),this.appendCommentArrow(),this.button.addClass("selected"),this.cursorPos=null},removePicker:function(){this.emojiPicker&&this.emojiPicker.destroy();var i=document.querySelector("."+this.dismissAreaClass);this.button&&this.button.removeClass("selected"),this.emojiArea&&(this.emojiArea.innerHTML=""),i&&(this.detachRegisteredEvent(e.one("body").one("."+this.dismissAreaClass).on("click",this.removePicker.bind(this))),i.remove()),this.appContext.flipper.isFlipped("enable-custom-text-parser")&&(!this.emojiPicked&&this.textSpan&&this.fire("removeSpan",this.textSpan),this.emojiPicked=!1,this.textSpan=null)},regexTrigger:function(e){this.addPicker(),this.appContext.flipper.isFlipped("enable-custom-text-parser")&&(this.textSpan=e.span);var i=this.get("container").one("input").getDOMNode(),t=e.input.length;i.value=e.input.substr(1,t-1),i.focus(),i.selectionStart=i.selectionEnd=t-1},appendCommentArrow:function(){var i=document.querySelector(".attach-to-input");e.one(i).append('<div class="upward-arrow"></div>')}})},"@VERSION@",{requires:["flickr-view","hermes-template-emoji-picker"],langBundles:["common","comments","search"]});